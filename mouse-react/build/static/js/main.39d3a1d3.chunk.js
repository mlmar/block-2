(this["webpackJsonpblock-react"]=this["webpackJsonpblock-react"]||[]).push([[0],{45:function(e,t,n){},46:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o),c=n(37),l=n.n(c),a=(n(45),n(3)),s=(n(46),n(14)),r=n(2),u=n(1),d="text-input large bold",b=function(e){var t=e.name,n=e.setName,i=Object(r.i)().room,c=Object(o.useState)(null),l=Object(a.a)(c,2),b=l[0],j=l[1],h=Object(o.useState)(i),f=Object(a.a)(h,2),v=f[0],x=f[1];Object(o.useEffect)((function(){document.title=i||"block"}),[i]);var m=function(e){"Enter"===e.key&&t&&v&&j(Object(u.jsx)(r.a,{to:"/".concat(v)}))};return b||Object(u.jsxs)("div",{className:"home",children:[Object(u.jsx)("input",{className:d,type:"text",placeholder:"name",onChange:function(e){n(e.target.value)},onKeyPress:i?m:null,autoFocus:!0}),!i&&Object(u.jsx)("input",{className:d+(t||v?"":" hide"),type:"text",placeholder:"room code",onChange:function(e){x(e.target.value)},onKeyPress:i?m:null}),Object(u.jsx)(s.b,{className:"round-btn medium"+(t&&v?"":" hide"),to:"/".concat(v),children:" join "})]})},j=735,h=735,f=15,v="#03a9f4",x=500,m={WIDTH:j/f,HEIGHT:h/f,STEP:f};Math.floor(m.WIDTH/2),Math.floor(m.HEIGHT/2);(j%f||j%f)&&console.warn("Height or width must be divisible by step");var O="https://block10.herokuapp.com",p=null===O||void 0===O?void 0:O.replace("http://","").replace("https://",""),y=n(38),g=n.n(y)()("https://block10.herokuapp.com",{transports:["websocket"]}),S=n(10),E=n(39),T=n(40),N=new(function(){function e(){Object(E.a)(this,e),this.canvas=null,this.ctx=null,this.img=new Image,this.update=!1,this.colors={clear:"WHITE",rect:"BLACK"}}return Object(T.a)(e,[{key:"init",value:function(e){(null===e||void 0===e?void 0:e.current)?(console.log("Initializing Canvas"),this.canvas=e.current,this.parent=e.current.parentElement,this.ctx=this.canvas.getContext("2d"),this.clear()):console.log("Could not initialize Canvas")}},{key:"clear",value:function(){this.canvas&&(this.ctx.fillStyle=this.colors.clear,this.ctx.fillRect(0,0,this.w(),this.h()))}},{key:"getData",value:function(){if(this.canvas)return this.canvas.toDataURL()}},{key:"setData",value:function(e){var t=this;if(this.canvas){var n=new Image;n.onload=function(){t.ctx.drawImage(n,0,0,t.canvas.width,t.canvas.height)},this.img.src=e,this.update=!0}}},{key:"draw",value:function(){var e=this;if(this.canvas){requestAnimationFrame((function t(){e.update&&(e.update=!1,e.ctx.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)),requestAnimationFrame(t)}))}}},{key:"rect",value:function(e,t,n,o,i){this.ctx.fillStyle=i||this.colors.rect,this.ctx.fillRect(e,t,n,o)}},{key:"outline",value:function(e,t,n,o,i){this.ctx.translate(.5,.5),this.ctx.strokeStyle=i||this.colors.rect,this.ctx.lineWidth=2,this.ctx.strokeRect(e,t,n,o),this.ctx.setTransform(1,0,0,1,0,0)}},{key:"w",value:function(){return this.canvas.width}},{key:"h",value:function(){return this.canvas.height}},{key:"setColors",value:function(e){this.colors=Object(S.a)(Object(S.a)({},this.colors),e)}}]),e}()),P={id:null,position:{x:null,y:null},color:v,alive:!0},k={},w={},C={},A={},I=0,R=!1,L=function(e){var t=P.position.x,n=P.position.y,o=e.x<=t&&t<e.x+e.width,i=e.y<=n&&n<e.y+e.height;return o&&i},D=function(e,t){var n=e.x===t.x&&e.y===t.y,o=e.x===t.x&&e.y-m.STEP===t.y,i=e.x===t.x&&e.y+m.STEP===t.y,c=e.x-m.STEP===t.x&&e.y===t.y,l=e.x+m.STEP===t.x&&e.y===t.y;return n||o||i||c||l},M=function(e){P=Object(S.a)(Object(S.a)({},P),e)},F=function(e){k=e},H=null,_=function(){P.alive&&(P.alive=!1,H&&H())},K=function(e){R=e},q=0,G=0,Y=function(){requestAnimationFrame((function e(t){G=(t-q)/16,q=t,R||(N.clear(),function(){for(var e=Object.keys(C),t=0;t<e.length;t++){var n=e[t],o=C[n],i=o.x,c=o.y,l=o.color;N.rect(i,c,m.STEP,m.STEP,l)}}(),function(){for(var e in k){var t,n=k[e];P.id!==n.id&&n.alive&&(D(n.position,P)&&console.log("TOUCHING PLAYERS"),N.rect(n.position.x,n.position.y,m.STEP,m.STEP,n.color),(null===(t=A)||void 0===t?void 0:t.id)===n.id&&N.outline(n.position.x,n.position.y,m.STEP,m.STEP,"RED"))}}(),function(){var e;if(P.alive){var t=P.position,n=t.x,o=t.y;N.rect(n,o,m.STEP,m.STEP,P.color),(null===(e=A)||void 0===e?void 0:e.id)===P.id&&N.outline(n,o,m.STEP,m.STEP,"RED")}}(),function(){var e=P.position.x,t=P.position.y;(e<I*m.STEP||e>=j-I*m.STEP||t<I*m.STEP||t>=h-I*m.STEP)&&_()}(),function(e){var t,n=Object.keys(w);n.length>100&&console.log("BLOCKS array is getting quite large! @ ",n.length);for(var o=0;o<n.length;o++){var i=n[o];w[i].x+=w[i].velocity.x*e,w[i].y+=w[i].velocity.y*e,w[i].age+=e,t=w[i],N.rect(t.x,t.y,t.width,t.height,t.color),L(w[i])&&_(),w[i].age>x&&delete w[i]}}(G)),requestAnimationFrame(e)}))},z=function(){return Object(u.jsxs)("div",{className:"flex-col",children:[Object(u.jsx)("p",{className:"small bold center-text",children:" A random player starts off as the bomb. "}),Object(u.jsx)("p",{className:"small bold center-text",children:" Touch a yellow square to transfer the bomb to someone else before the timer runs out. "}),Object(u.jsx)("p",{className:"small bold center-text",children:" Non-bombers can steal yellow squares from the bomb. "}),Object(u.jsx)("p",{className:"small bold center-text",children:" Careful \u2014 the board gets smaller over time and you can get crushed by moving blocks. "})]})},B=function(e){var t=e.id,n=e.players,o=e.children,i=e.color,c=e.onChange,l=function(e){c&&c(e.target.value)};return Object(u.jsxs)("div",{className:"lobby flex-col flex-fill",children:[Object(u.jsx)("div",{className:"player-list flex-col",children:null===n||void 0===n?void 0:n.map((function(e){var n=e.id===t,o={color:e.color},c=n?" bold":"",a=n?Object(u.jsxs)("span",{children:[" ",Object(u.jsx)("input",{type:"color",value:i,onChange:l})," "]}):null;return Object(u.jsxs)("label",{className:"flex medium"+c,style:o,children:[" ",e.nickname," ",a," "]},e.id)}))}),o]})},U=function(e){var t=e.width,n=e.height,i=e.onMouseMove,c=e.onKey,l=e.zoomMultiplier,a=e.className,s=Object(o.useRef)(null),r=Object(o.useRef)(null);Object(o.useEffect)((function(){s.current&&(s.current.focus(),function(e){N.init(e),N.clear()}(s),Y())}),[t,n]);var d={transform:"scale(".concat(j/(j-l*f*2),")")};return Object(u.jsx)("div",{className:"canvas-wrapper",children:Object(u.jsx)("canvas",{className:a||"",width:j,height:h,onMouseMove:function(e){if(i){var t=e.clientX,n=e.clientY,o=e.target,c=o.offsetTop,l=t-o.offsetLeft,a=n-c;r.current={x:l,y:a},i&&i(r.current)}},onKeyDown:function(e){c&&c(e.key)},onContextMenu:function(e){e.preventDefault()},tabIndex:1,ref:s,style:d})})},W=function(e){var t=e.onPress,n=function(e){var n=e.target.id;t&&t(n)};return Object(u.jsxs)("div",{className:"flex mobile controls",children:[Object(u.jsx)("button",{id:"a",onTouchStart:n}),Object(u.jsxs)("div",{className:"flex-col",children:[Object(u.jsx)("button",{id:"w",onTouchStart:n}),Object(u.jsx)("button",{id:"s",onTouchStart:n})]}),Object(u.jsx)("button",{id:"d",onTouchStart:n})]})},J=function(e){var t=e.name,n=Object(r.i)().room,i=Object(o.useState)(0),c=Object(a.a)(i,2),l=c[0],s=c[1],d=Object(o.useState)(null),b=Object(a.a)(d,2),j=b[0],h=b[1],f=Object(o.useState)(null),x=Object(a.a)(f,2),O=x[0],y=x[1],E=Object(o.useState)(v),T=Object(a.a)(E,2),N=T[0],k=T[1],L=Object(o.useState)(null),D=Object(a.a)(L,2),_=D[0],q=D[1],G=Object(o.useState)(0),Y=Object(a.a)(G,2),J=Y[0],X=Y[1],Q=Object(o.useState)(null),V=Object(a.a)(Q,2),Z=V[0],$=V[1],ee=Object(o.useState)(null),te=Object(a.a)(ee,2),ne=te[0],oe=te[1],ie=Object(o.useState)(!1),ce=Object(a.a)(ie,2),le=ce[0],ae=ce[1];Object(o.useEffect)((function(){t&&(g.emit("SET_NICK",t),g.emit("JOIN_ROOM",n),g.on("START_GAME",(function(){s(1),ae(!1),K(!1)})),g.on("ROOM_UPDATE",(function(e){var t,n;e.end&&(oe(e.message),K(!0),ae(!0),P=Object(S.a)(Object(S.a)({},P),{},{alive:!0}),w={},C={},A={},I=0),h(null===e||void 0===e?void 0:e.host),y(null===e||void 0===e?void 0:e.playersList),F(null===e||void 0===e?void 0:e.players),n=null===e||void 0===e||null===(t=e.players[g.id])||void 0===t?void 0:t.position,P.position=n,(null===e||void 0===e?void 0:e.difficulty)>0&&s(1)})),g.on("GENERATION",(function(e){var t;t=e,w=Object(S.a)(Object(S.a)({},null===t||void 0===t?void 0:t.blocks),w),C=null===t||void 0===t?void 0:t.pickups,A=null===t||void 0===t?void 0:t.bomb,I=null===t||void 0===t?void 0:t.limit,X(null===e||void 0===e?void 0:e.limit),q(e.bomb)})),g.on("POSITIONS",F),g.on("PLAYER_COLORS",(function(e){y(e.playersList),F(e.players)})),g.on("EXPLODE",(function(){M({alive:!1}),de()})))}),[n,t]),Object(o.useEffect)((function(){M({id:g.id}),H=function(){g.emit("PLAYER_DEATH"),de()}}),[]);var se=function(){g.emit("START_GAME")},re=function(e){var t=function(e){if(P.alive&&!R)return"w"!==e&&"ArrowUp"!==e||(P.position.y-=m.STEP),"s"!==e&&"ArrowDown"!==e||(P.position.y+=m.STEP),"a"!==e&&"ArrowLeft"!==e||(P.position.x-=m.STEP),"d"!==e&&"ArrowRight"!==e||(P.position.x+=m.STEP),P.position}(e);t&&g.emit("PLAYER_POSITION",t)},ue=function(e){k(e),function(e){P.color=e}(e),g.emit("PLAYER_COLOR",e)},de=function(){$("animate-shake"),setTimeout((function(){$(null)}),500)},be=function(){ae(!1),q(0),s(0),X(0),K(!1)};if(!t)return Object(u.jsx)(r.a,{to:"/".concat(n,"/@")});var je="room flex-col flex-fill"+(1===l?" dark":"");return Object(u.jsx)("div",{className:je,children:1===l?Object(u.jsxs)("div",{className:"game flex-col flex-fill",children:[le&&Object(u.jsxs)("div",{className:"end-screen flex-col",children:[Object(u.jsxs)("label",{className:"huge bold",children:[" ",ne," "]}),Object(u.jsx)("button",{className:"round-btn large bold",onClick:be,children:" back to lobby "})]}),Object(u.jsxs)("label",{className:"large bold center-text",children:[" ",null===_||void 0===_?void 0:_.timer," ",Object(u.jsx)(u.Fragment,{children:" \u2014 "})," ",null===_||void 0===_?void 0:_.nickname," "]}),Object(u.jsx)(U,{className:Z,onKey:re,zoomMultiplier:J}),Object(u.jsx)(W,{onPress:re})]}):Object(u.jsxs)("div",{className:"flex-col flex-fill",children:[Object(u.jsxs)("label",{className:"large bold center-text",children:[" ",p,"/",n," "]}),Object(u.jsx)(z,{}),Object(u.jsx)(B,{id:g.id,players:O,color:N,onChange:ue,children:(null===j||void 0===j?void 0:j.id)===g.id&&Object(u.jsx)("button",{className:"round-btn large bold",onClick:se,children:" start "})})]})})},X=function(){var e=Object(o.useState)(null),t=Object(a.a)(e,2),n=t[0],i=t[1];return Object(u.jsx)("div",{className:"app",children:Object(u.jsx)(s.a,{children:Object(u.jsxs)(r.d,{children:[Object(u.jsx)(r.b,{path:"/",element:Object(u.jsx)(b,{name:n,setName:i})}),Object(u.jsx)(r.b,{path:"/:room/@",element:Object(u.jsx)(b,{name:n,setName:i})}),Object(u.jsx)(r.b,{path:"/:room",element:Object(u.jsx)(J,{name:n})})]})})})},Q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,82)).then((function(t){var n=t.getCLS,o=t.getFID,i=t.getFCP,c=t.getLCP,l=t.getTTFB;n(e),o(e),i(e),c(e),l(e)}))};l.a.render(Object(u.jsx)(i.a.StrictMode,{children:Object(u.jsx)(X,{})}),document.getElementById("root")),Q()}},[[81,1,2]]]);
//# sourceMappingURL=main.39d3a1d3.chunk.js.map