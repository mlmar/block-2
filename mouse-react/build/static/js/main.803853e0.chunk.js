(this["webpackJsonpblock-react"]=this["webpackJsonpblock-react"]||[]).push([[0],{45:function(e,t,n){},46:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),c=n(37),l=n.n(c),a=(n(45),n(3)),s=(n(46),n(14)),r=n(2),u=n(1),d="text-input large bold",b=function(e){var t=e.name,n=e.setName,o=Object(r.i)().room,c=Object(i.useState)(null),l=Object(a.a)(c,2),b=l[0],j=l[1],h=Object(i.useState)(o),f=Object(a.a)(h,2),v=f[0],x=f[1];Object(i.useEffect)((function(){document.title=o||"block"}),[o]);var O=function(e){"Enter"===e.key&&t&&v&&j(Object(u.jsx)(r.a,{to:"/".concat(v)}))};return b||Object(u.jsxs)("div",{className:"home",children:[Object(u.jsx)("input",{className:d,type:"text",placeholder:"name",onChange:function(e){n(e.target.value)},onKeyPress:o?O:null,autoFocus:!0}),!o&&Object(u.jsx)("input",{className:d+(t||v?"":" hide"),type:"text",placeholder:"room code",onChange:function(e){x(e.target.value)},onKeyPress:o?O:null}),Object(u.jsx)(s.b,{className:"round-btn medium"+(t&&v?"":" hide"),to:"/".concat(v),children:" join "})]})},j=735,h=735,f=15,v="#3c3cff",x=500,O={WIDTH:j/f,HEIGHT:h/f,STEP:f};Math.floor(O.WIDTH/2),Math.floor(O.HEIGHT/2);(j%f||j%f)&&console.warn("Height or width must be divisible by step");var m="https://block10.herokuapp.com",p=null===m||void 0===m?void 0:m.replace("http://","").replace("https://",""),y=n(38),g=n.n(y)()("https://block10.herokuapp.com",{transports:["websocket"]}),S=n(10),E=n(39),T=n(40),N=new(function(){function e(){Object(E.a)(this,e),this.canvas=null,this.ctx=null,this.img=new Image,this.update=!1,this.colors={clear:"WHITE",rect:"BLACK"}}return Object(T.a)(e,[{key:"init",value:function(e){(null===e||void 0===e?void 0:e.current)?(console.log("Initializing Canvas"),this.canvas=e.current,this.parent=e.current.parentElement,this.ctx=this.canvas.getContext("2d"),this.clear()):console.log("Could not initialize Canvas")}},{key:"clear",value:function(){this.canvas&&(this.ctx.fillStyle=this.colors.clear,this.ctx.fillRect(0,0,this.w(),this.h()))}},{key:"getData",value:function(){if(this.canvas)return this.canvas.toDataURL()}},{key:"setData",value:function(e){var t=this;if(this.canvas){var n=new Image;n.onload=function(){t.ctx.drawImage(n,0,0,t.canvas.width,t.canvas.height)},this.img.src=e,this.update=!0}}},{key:"draw",value:function(){var e=this;if(this.canvas){requestAnimationFrame((function t(){e.update&&(e.update=!1,e.ctx.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)),requestAnimationFrame(t)}))}}},{key:"rect",value:function(e,t,n,i,o){this.ctx.fillStyle=o||this.colors.rect,this.ctx.fillRect(e,t,n,i)}},{key:"outline",value:function(e,t,n,i,o){this.ctx.translate(.5,.5),this.ctx.strokeStyle=o||this.colors.rect,this.ctx.lineWidth=2,this.ctx.strokeRect(e,t,n,i),this.ctx.setTransform(1,0,0,1,0,0)}},{key:"w",value:function(){return this.canvas.width}},{key:"h",value:function(){return this.canvas.height}},{key:"setColors",value:function(e){this.colors=Object(S.a)(Object(S.a)({},this.colors),e)}}]),e}()),P={id:null,position:{x:null,y:null},color:v,alive:!0},k={},w={},A={},C={},I=0,R=!1,L=function(e){var t=P.position.x,n=P.position.y,i=e.x<=t&&t<e.x+e.width,o=e.y<=n&&n<e.y+e.height;return i&&o},D=function(e,t){var n=e.x===t.x&&e.y===t.y,i=e.x===t.x&&e.y-O.STEP===t.y,o=e.x===t.x&&e.y+O.STEP===t.y,c=e.x-O.STEP===t.x&&e.y===t.y,l=e.x+O.STEP===t.x&&e.y===t.y;return n||i||o||c||l},M=function(e){P=Object(S.a)(Object(S.a)({},P),e)},F=function(e){k=e},H=null,_=function(){P.alive&&(P.alive=!1,H&&H())},K=function(e){R=e},q=0,G=0,Y=function(){requestAnimationFrame((function e(t){G=(t-q)/16,q=t,R||(N.clear(),function(){for(var e=Object.keys(A),t=0;t<e.length;t++){var n=e[t],i=A[n],o=i.x,c=i.y,l=i.color;N.rect(o,c,O.STEP,O.STEP,l)}}(),function(){for(var e in k){var t,n=k[e];P.id!==n.id&&n.alive&&(D(n.position,P)&&console.log("TOUCHING PLAYERS"),N.rect(n.position.x,n.position.y,O.STEP,O.STEP,n.color),(null===(t=C)||void 0===t?void 0:t.id)===n.id&&N.outline(n.position.x,n.position.y,O.STEP,O.STEP,"RED"))}}(),function(){var e;if(P.alive){var t=P.position,n=t.x,i=t.y;N.rect(n,i,O.STEP,O.STEP,P.color),(null===(e=C)||void 0===e?void 0:e.id)===P.id&&N.outline(n,i,O.STEP,O.STEP,"RED")}}(),function(){var e=P.position.x,t=P.position.y;(e<I*O.STEP||e>=j-I*O.STEP||t<I*O.STEP||t>=h-I*O.STEP)&&_()}(),function(e){var t,n=Object.keys(w);n.length>100&&console.log("BLOCKS array is getting quite large! @ ",n.length);for(var i=0;i<n.length;i++){var o=n[i];w[o].x+=w[o].velocity.x*e,w[o].y+=w[o].velocity.y*e,w[o].age+=e,t=w[o],N.rect(t.x,t.y,t.width,t.height,t.color),L(w[o])&&_(),w[o].age>x&&delete w[o]}}(G)),requestAnimationFrame(e)}))},z=function(){return Object(u.jsxs)("div",{className:"flex-col",children:[Object(u.jsx)("p",{className:"small bold center-text",children:" A random player starts off as the bomb. "}),Object(u.jsx)("p",{className:"small bold center-text",children:" Touch a yellow square to transfer the bomb to someone else before the timer runs out. "}),Object(u.jsx)("p",{className:"small bold center-text",children:" Non-bombers can steal yellow squares from the bomb. "})]})},B=function(e){var t=e.id,n=e.players,i=e.children,o=e.color,c=e.onChange,l=function(e){c&&c(e.target.value)};return Object(u.jsxs)("div",{className:"lobby flex-col flex-fill",children:[Object(u.jsx)("div",{className:"player-list flex-col",children:null===n||void 0===n?void 0:n.map((function(e){var n=e.id===t,i={color:e.color},c=n?" bold":"",a=n?Object(u.jsxs)("span",{children:[" ",Object(u.jsx)("input",{type:"color",value:o,onChange:l})," "]}):null;return Object(u.jsxs)("label",{className:"flex medium"+c,style:i,children:[" ",e.nickname," ",a," "]},e.id)}))}),i]})},U=function(e){var t=e.width,n=e.height,o=e.onMouseMove,c=e.onKey,l=e.zoomMultiplier,a=e.className,s=Object(i.useRef)(null),r=Object(i.useRef)(null);Object(i.useEffect)((function(){s.current&&(s.current.focus(),function(e){N.init(e),N.clear()}(s),Y())}),[t,n]);var d={transform:"scale(".concat(j/(j-l*f*2),")")};return Object(u.jsx)("div",{className:"canvas-wrapper",children:Object(u.jsx)("canvas",{className:a||"",width:j,height:h,onMouseMove:function(e){if(o){var t=e.clientX,n=e.clientY,i=e.target,c=i.offsetTop,l=t-i.offsetLeft,a=n-c;r.current={x:l,y:a},o&&o(r.current)}},onKeyDown:function(e){c&&c(e.key)},onContextMenu:function(e){e.preventDefault()},tabIndex:1,ref:s,style:d})})},W=function(e){var t=e.onPress,n=function(e){var n=e.target.id;t&&t(n)};return Object(u.jsxs)("div",{className:"flex mobile controls",children:[Object(u.jsx)("button",{id:"a",onTouchStart:n}),Object(u.jsxs)("div",{className:"flex-col",children:[Object(u.jsx)("button",{id:"w",onTouchStart:n}),Object(u.jsx)("button",{id:"s",onTouchStart:n})]}),Object(u.jsx)("button",{id:"d",onTouchStart:n})]})},J=function(e){var t=e.name,n=Object(r.i)().room,o=Object(i.useState)(0),c=Object(a.a)(o,2),l=c[0],s=c[1],d=Object(i.useState)(null),b=Object(a.a)(d,2),j=b[0],h=b[1],f=Object(i.useState)(null),x=Object(a.a)(f,2),m=x[0],y=x[1],E=Object(i.useState)(v),T=Object(a.a)(E,2),N=T[0],k=T[1],L=Object(i.useState)(null),D=Object(a.a)(L,2),_=D[0],q=D[1],G=Object(i.useState)(0),Y=Object(a.a)(G,2),J=Y[0],X=Y[1],Q=Object(i.useState)(null),V=Object(a.a)(Q,2),Z=V[0],$=V[1],ee=Object(i.useState)(null),te=Object(a.a)(ee,2),ne=te[0],ie=te[1],oe=Object(i.useState)(!1),ce=Object(a.a)(oe,2),le=ce[0],ae=ce[1];Object(i.useEffect)((function(){t&&(g.emit("SET_NICK",t),g.emit("JOIN_ROOM",n),g.on("START_GAME",(function(){s(1),ae(!1),K(!1)})),g.on("ROOM_UPDATE",(function(e){var t,n;e.end&&(ie(e.message),K(!0),ae(!0),P=Object(S.a)(Object(S.a)({},P),{},{alive:!0}),w={},A={},C={},I=0),h(null===e||void 0===e?void 0:e.host),y(null===e||void 0===e?void 0:e.playersList),F(null===e||void 0===e?void 0:e.players),n=null===e||void 0===e||null===(t=e.players[g.id])||void 0===t?void 0:t.position,P.position=n,(null===e||void 0===e?void 0:e.difficulty)>0&&s(1)})),g.on("GENERATION",(function(e){var t;t=e,w=Object(S.a)(Object(S.a)({},null===t||void 0===t?void 0:t.blocks),w),A=null===t||void 0===t?void 0:t.pickups,C=null===t||void 0===t?void 0:t.bomb,I=null===t||void 0===t?void 0:t.limit,X(null===e||void 0===e?void 0:e.limit),q(e.bomb)})),g.on("POSITIONS",F),g.on("PLAYER_COLORS",(function(e){y(e.playersList),F(e.players)})),g.on("EXPLODE",(function(){M({alive:!1}),be()})))}),[n,t]),Object(i.useEffect)((function(){M({id:g.id}),H=de}),[]);var se=function(){g.emit("START_GAME")},re=function(e){var t=function(e){if(P.alive&&!R)return"w"!==e&&"ArrowUp"!==e||(P.position.y-=O.STEP),"s"!==e&&"ArrowDown"!==e||(P.position.y+=O.STEP),"a"!==e&&"ArrowLeft"!==e||(P.position.x-=O.STEP),"d"!==e&&"ArrowRight"!==e||(P.position.x+=O.STEP),P.position}(e);t&&g.emit("PLAYER_POSITION",t)},ue=function(e){k(e),function(e){P.color=e}(e),g.emit("PLAYER_COLOR",e)},de=function(){g.emit("PLAYER_DEATH"),be()},be=function(){$("animate-shake"),setTimeout((function(){$(null)}),500)},je=function(){ae(!1),q(0),s(0),X(0),K(!1)};if(!t)return Object(u.jsx)(r.a,{to:"/".concat(n,"/@")});var he="room flex-col flex-fill"+(1===l?" dark":"");return Object(u.jsx)("div",{className:he,children:1===l?Object(u.jsxs)("div",{className:"game flex-col flex-fill",children:[le&&Object(u.jsxs)("div",{className:"end-screen flex-col",children:[Object(u.jsxs)("label",{className:"huge bold",children:[" ",ne," "]}),Object(u.jsx)("button",{className:"round-btn large bold",onClick:je,children:" back to lobby "})]}),Object(u.jsxs)("label",{className:"large bold center-text",children:[" ",null===_||void 0===_?void 0:_.timer," ",Object(u.jsx)(u.Fragment,{children:" \u2014 "})," ",null===_||void 0===_?void 0:_.nickname," "]}),Object(u.jsx)(U,{className:Z,onKey:re,zoomMultiplier:J}),Object(u.jsx)(W,{onPress:re})]}):Object(u.jsxs)("div",{className:"flex-col flex-fill",children:[Object(u.jsxs)("label",{className:"large bold center-text",children:[" ",p,"/",n," "]}),Object(u.jsx)(z,{}),Object(u.jsx)(B,{id:g.id,players:m,color:N,onChange:ue,children:(null===j||void 0===j?void 0:j.id)===g.id&&Object(u.jsx)("button",{className:"round-btn large bold",onClick:se,children:" start "})})]})})},X=function(){var e=Object(i.useState)(null),t=Object(a.a)(e,2),n=t[0],o=t[1];return Object(u.jsx)("div",{className:"app",children:Object(u.jsx)(s.a,{children:Object(u.jsxs)(r.d,{children:[Object(u.jsx)(r.b,{path:"/",element:Object(u.jsx)(b,{name:n,setName:o})}),Object(u.jsx)(r.b,{path:"/:room/@",element:Object(u.jsx)(b,{name:n,setName:o})}),Object(u.jsx)(r.b,{path:"/:room",element:Object(u.jsx)(J,{name:n})})]})})})},Q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,82)).then((function(t){var n=t.getCLS,i=t.getFID,o=t.getFCP,c=t.getLCP,l=t.getTTFB;n(e),i(e),o(e),c(e),l(e)}))};l.a.render(Object(u.jsx)(o.a.StrictMode,{children:Object(u.jsx)(X,{})}),document.getElementById("root")),Q()}},[[81,1,2]]]);
//# sourceMappingURL=main.803853e0.chunk.js.map