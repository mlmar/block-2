(this["webpackJsonpblock-react"]=this["webpackJsonpblock-react"]||[]).push([[0],{45:function(e,t,n){},46:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var i=n(0),c=n.n(i),o=n(37),a=n.n(o),l=(n(45),n(3)),s=(n(46),n(14)),r=n(2),u=n(1),d="text-input large bold",b=function(e){var t=e.name,n=e.setName,c=Object(r.i)().room,o=Object(i.useState)(null),a=Object(l.a)(o,2),b=a[0],j=a[1],h=Object(i.useState)(c),v=Object(l.a)(h,2),f=v[0],O=v[1];Object(i.useEffect)((function(){document.title=c||"block"}),[c]);var m=function(e){"Enter"===e.key&&t&&f&&j(Object(u.jsx)(r.a,{to:"/".concat(f)}))};return b||Object(u.jsxs)("div",{className:"home",children:[Object(u.jsx)("input",{className:d,type:"text",placeholder:"name",onChange:function(e){n(e.target.value)},onKeyPress:c?m:null,autoFocus:!0}),!c&&Object(u.jsx)("input",{className:d+(t||f?"":" hide"),type:"text",placeholder:"room code",onChange:function(e){O(e.target.value)},onKeyPress:c?m:null}),Object(u.jsx)(s.b,{className:"round-btn medium"+(t&&f?"":" hide"),to:"/".concat(f),children:" join "})]})},j=735,h=735,v=15,f="#3c3cff",O=500,m={WIDTH:j/v,HEIGHT:h/v,STEP:v};Math.floor(m.WIDTH/2),Math.floor(m.HEIGHT/2);(j%v||j%v)&&console.warn("Height or width must be divisible by step");var x="http://localhost:3000",p=null===x||void 0===x?void 0:x.replace("http://","").replace("https://",""),y=n(38),g=n.n(y)()("http://localhost:3300",{transports:["websocket"]}),S=n(10),E=n(39),T=n(40),P=new(function(){function e(){Object(E.a)(this,e),this.canvas=null,this.ctx=null,this.img=new Image,this.update=!1,this.colors={clear:"WHITE",rect:"BLACK"}}return Object(T.a)(e,[{key:"init",value:function(e){(null===e||void 0===e?void 0:e.current)?(console.log("Initializing Canvas"),this.canvas=e.current,this.parent=e.current.parentElement,this.ctx=this.canvas.getContext("2d"),this.clear()):console.log("Could not initialize Canvas")}},{key:"clear",value:function(){this.canvas&&(this.ctx.fillStyle=this.colors.clear,this.ctx.fillRect(0,0,this.w(),this.h()))}},{key:"getData",value:function(){if(this.canvas)return this.canvas.toDataURL()}},{key:"setData",value:function(e){var t=this;if(this.canvas){var n=new Image;n.onload=function(){t.ctx.drawImage(n,0,0,t.canvas.width,t.canvas.height)},this.img.src=e,this.update=!0}}},{key:"draw",value:function(){var e=this;if(this.canvas){requestAnimationFrame((function t(){e.update&&(e.update=!1,e.ctx.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)),requestAnimationFrame(t)}))}}},{key:"rect",value:function(e,t,n,i,c){this.ctx.fillStyle=c||this.colors.rect,this.ctx.fillRect(e,t,n,i)}},{key:"w",value:function(){return this.canvas.width}},{key:"h",value:function(){return this.canvas.height}},{key:"setColors",value:function(e){this.colors=Object(S.a)(Object(S.a)({},this.colors),e)}}]),e}()),N={id:null,position:{x:null,y:null},color:f,alive:!0},w={},k={},C={},I=0,A=!1,R=function(e){var t=N.position.x,n=N.position.y,i=e.x<=t&&t<e.x+e.width,c=e.y<=n&&n<e.y+e.height;return i&&c},M=function(e,t){var n=e.x===t.x&&e.y===t.y,i=e.x===t.x&&e.y-m.STEP===t.y,c=e.x===t.x&&e.y+m.STEP===t.y,o=e.x-m.STEP===t.x&&e.y===t.y,a=e.x+m.STEP===t.x&&e.y===t.y;return n||i||c||o||a},L=function(e){w=e},D=null,F=function(){N.alive&&(N.alive=!1,D&&D())},H=function(e){A=e},K=0,_=0,G=function(){requestAnimationFrame((function e(t){_=(t-K)/16,K=t,A||(P.clear(),function(){for(var e=Object.keys(C),t=0;t<e.length;t++){var n=e[t],i=C[n],c=i.x,o=i.y,a=i.color;P.rect(c,o,m.STEP,m.STEP,a)}}(),function(){for(var e in w){var t=w[e];N.id!==t.id&&t.alive&&(M(t.position,N)&&console.log("TOUCHING PLAYERS"),P.rect(t.position.x,t.position.y,m.STEP,m.STEP,t.color))}}(),function(){if(N.alive){var e=N.position,t=e.x,n=e.y;P.rect(t,n,m.STEP,m.STEP,N.color)}}(),function(){var e=N.position.x,t=N.position.y;(e<I*m.STEP||e>=j-I*m.STEP||t<I*m.STEP||t>=h-I*m.STEP)&&F()}(),function(e){var t,n=Object.keys(k);n.length>100&&console.log("BLOCKS array is getting quite large! @ ",n.length);for(var i=0;i<n.length;i++){var c=n[i];k[c].x+=k[c].velocity.x*e,k[c].y+=k[c].velocity.y*e,k[c].age+=e,t=k[c],P.rect(t.x,t.y,t.width,t.height,t.color),R(k[c])&&F(),k[c].age>O&&delete k[c]}}(_)),requestAnimationFrame(e)}))},q=function(e){var t=e.id,n=e.players,i=e.children,c=e.color,o=e.onChange,a=function(e){o&&o(e.target.value)};return Object(u.jsxs)("div",{className:"lobby flex-col flex-fill",children:[Object(u.jsx)("div",{className:"player-list flex-col",children:null===n||void 0===n?void 0:n.map((function(e){var n=e.id===t,i=n?{color:c}:null,o=n?" bold":"",l=n?Object(u.jsxs)("span",{children:[" ",Object(u.jsx)("input",{type:"color",value:c,onChange:a})," "]}):null;return Object(u.jsxs)("label",{className:"flex medium"+o,style:i,children:[" ",e.nickname," ",l," "]},e.id)}))}),i]})},Y=function(e){var t=e.width,n=e.height,c=e.onMouseMove,o=e.onKey,a=e.zoomMultiplier,l=e.className,s=Object(i.useRef)(null),r=Object(i.useRef)(null);Object(i.useEffect)((function(){s.current&&(s.current.focus(),function(e){P.init(e),P.clear()}(s),G())}),[t,n]);var d={transform:"scale(".concat(j/(j-a*v*2),")")};return Object(u.jsx)("div",{className:"canvas-wrapper",children:Object(u.jsx)("canvas",{className:l||"",width:j,height:h,onMouseMove:function(e){if(c){var t=e.clientX,n=e.clientY,i=e.target,o=i.offsetTop,a=t-i.offsetLeft,l=n-o;r.current={x:a,y:l},c&&c(r.current)}},onKeyDown:function(e){o&&o(e.key)},onContextMenu:function(e){e.preventDefault()},tabIndex:1,ref:s,style:d})})},z=function(e){var t=e.name,n=Object(r.i)().room,c=Object(i.useState)(0),o=Object(l.a)(c,2),a=o[0],s=o[1],d=Object(i.useState)(null),b=Object(l.a)(d,2),j=b[0],h=b[1],v=Object(i.useState)(null),O=Object(l.a)(v,2),x=O[0],y=O[1],E=Object(i.useState)(f),T=Object(l.a)(E,2),P=T[0],w=T[1],R=Object(i.useState)(null),M=Object(l.a)(R,2),F=M[0],K=M[1],_=Object(i.useState)(0),G=Object(l.a)(_,2),z=G[0],B=G[1],U=Object(i.useState)(null),J=Object(l.a)(U,2),W=J[0],X=J[1],Q=Object(i.useState)(null),V=Object(l.a)(Q,2),Z=V[0],$=V[1],ee=Object(i.useState)(!1),te=Object(l.a)(ee,2),ne=te[0],ie=te[1];Object(i.useEffect)((function(){t&&(g.emit("SET_NICK",t),g.emit("JOIN_ROOM",n),g.on("START_GAME",(function(){s(1),ie(!1),H(!1)})),g.on("ROOM_UPDATE",(function(e){var t,n;e.end&&($(e.message),H(!0),ie(!0),N=Object(S.a)(Object(S.a)({},N),{},{alive:!0}),k={},C={},I=0),h(null===e||void 0===e?void 0:e.host),y(null===e||void 0===e?void 0:e.playersList),L(null===e||void 0===e?void 0:e.players),n=null===e||void 0===e||null===(t=e.players[g.id])||void 0===t?void 0:t.position,N.position=n,(null===e||void 0===e?void 0:e.difficulty)>0&&s(1)})),g.on("GENERATION",(function(e){var t;t=e,k=Object(S.a)(Object(S.a)({},null===t||void 0===t?void 0:t.blocks),k),C=null===t||void 0===t?void 0:t.pickups,I=null===t||void 0===t?void 0:t.limit,B(null===e||void 0===e?void 0:e.limit),K(null===e||void 0===e?void 0:e.alive)})),g.on("POSITIONS",L))}),[n,t]),Object(i.useEffect)((function(){var e;e={id:g.id},N=Object(S.a)(Object(S.a)({},N),e),D=le}),[]);var ce=function(){g.emit("START_GAME")},oe=function(e){var t=function(e){if(N.alive&&!A)return"w"!==e&&"ArrowUp"!==e||(N.position.y-=m.STEP),"s"!==e&&"ArrowDown"!==e||(N.position.y+=m.STEP),"a"!==e&&"ArrowLeft"!==e||(N.position.x-=m.STEP),"d"!==e&&"ArrowRight"!==e||(N.position.x+=m.STEP),N.position}(e);t&&g.emit("PLAYER_POSITION",t)},ae=function(e){w(e),function(e){N.color=e}(e),g.emit("PLAYER_COLOR",e)},le=function(){g.emit("PLAYER_DEATH"),X("animate-shake"),setTimeout((function(){X(null)}),500)},se=function(){ie(!1),s(0),B(0),H(!1)};if(!t)return Object(u.jsx)(r.a,{to:"/".concat(n,"/@")});var re="room flex-col flex-fill"+(1===a?" dark":"");return Object(u.jsx)("div",{className:re,children:1===a?Object(u.jsxs)(u.Fragment,{children:[ne&&Object(u.jsxs)("div",{className:"end-screen flex-col",children:[Object(u.jsxs)("label",{className:"huge bold",children:[" ",Z," "]}),Object(u.jsx)("button",{className:"round-btn large bold",onClick:se,children:" back to lobby "})]}),Object(u.jsxs)("label",{className:"large bold",children:[" ",F," player",F>1?"s":""," remaining "]}),Object(u.jsx)(Y,{className:W,onKey:oe,zoomMultiplier:z})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("label",{className:"large bold",children:[" ",p,"/",n," "]}),Object(u.jsx)(q,{id:g.id,players:x,color:P,onChange:ae,children:(null===j||void 0===j?void 0:j.id)===g.id&&Object(u.jsx)("button",{className:"round-btn large bold",onClick:ce,children:" start "})})]})})},B=function(){var e=Object(i.useState)(null),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(u.jsx)("div",{className:"app",children:Object(u.jsx)(s.a,{children:Object(u.jsxs)(r.d,{children:[Object(u.jsx)(r.b,{path:"/",element:Object(u.jsx)(b,{name:n,setName:c})}),Object(u.jsx)(r.b,{path:"/:room/@",element:Object(u.jsx)(b,{name:n,setName:c})}),Object(u.jsx)(r.b,{path:"/:room",element:Object(u.jsx)(z,{name:n})})]})})})},U=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,82)).then((function(t){var n=t.getCLS,i=t.getFID,c=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),i(e),c(e),o(e),a(e)}))};a.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(B,{})}),document.getElementById("root")),U()}},[[81,1,2]]]);
//# sourceMappingURL=main.90d67880.chunk.js.map