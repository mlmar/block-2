(this["webpackJsonpblock-react"]=this["webpackJsonpblock-react"]||[]).push([[0],{46:function(e,t,n){},47:function(e,t,n){},82:function(e,t,n){"use strict";n.r(t);var c=n(0),i=n.n(c),o=n(37),a=n.n(o),l=(n(46),n(3)),s=(n(47),n(14)),r=n(2),u=n(38),d=n.n(u),b=n(1),j="text-input large bold",f=function(e){var t=e.name,n=e.setName,i=Object(r.i)().room,o=Object(c.useState)(null),a=Object(l.a)(o,2),u=a[0],d=a[1],f=Object(c.useState)(i),v=Object(l.a)(f,2),h=v[0],O=v[1];Object(c.useEffect)((function(){document.title=i||"block"}),[i]);var x=function(e){"Enter"===e.key&&t&&h&&d(Object(b.jsx)(r.a,{to:"/".concat(h)}))};return u||Object(b.jsxs)("div",{className:"home",children:[Object(b.jsx)("input",{className:j,type:"text",placeholder:"name",onChange:function(e){n(e.target.value)},onKeyPress:i?x:null,autoFocus:!0}),!i&&Object(b.jsx)("input",{className:j+(t||h?"":" hide"),type:"text",placeholder:"room code",onChange:function(e){O(e.target.value)},onKeyPress:i?x:null}),Object(b.jsx)(s.b,{className:"round-btn medium"+(t&&h?"":" hide"),to:"/".concat(h),children:" join "})]})},v=735,h=735,O=15,x="#3c3cff",m=500,p={WIDTH:v/O,HEIGHT:h/O,STEP:O};Math.floor(p.WIDTH/2),Math.floor(p.HEIGHT/2);(v%O||v%O)&&console.warn("Height or width must be divisible by step");var y="https://block10.herokuapp.com",g=null===y||void 0===y?void 0:y.replace("http://","").replace("https://",""),S=n(39),E=n.n(S)()("https://block10.herokuapp.com",{transports:["websocket"]}),T=n(10),k=n(40),N=n(41),P=new(function(){function e(){Object(k.a)(this,e),this.canvas=null,this.ctx=null,this.img=new Image,this.update=!1,this.colors={clear:"WHITE",rect:"BLACK"}}return Object(N.a)(e,[{key:"init",value:function(e){(null===e||void 0===e?void 0:e.current)?(console.log("Initializing Canvas"),this.canvas=e.current,this.parent=e.current.parentElement,this.ctx=this.canvas.getContext("2d"),this.clear()):console.log("Could not initialize Canvas")}},{key:"clear",value:function(){this.canvas&&(this.ctx.fillStyle=this.colors.clear,this.ctx.fillRect(0,0,this.w(),this.h()))}},{key:"getData",value:function(){if(this.canvas)return this.canvas.toDataURL()}},{key:"setData",value:function(e){var t=this;if(this.canvas){var n=new Image;n.onload=function(){t.ctx.drawImage(n,0,0,t.canvas.width,t.canvas.height)},this.img.src=e,this.update=!0}}},{key:"draw",value:function(){var e=this;if(this.canvas){requestAnimationFrame((function t(){e.update&&(e.update=!1,e.ctx.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)),requestAnimationFrame(t)}))}}},{key:"rect",value:function(e,t,n,c,i){this.ctx.fillStyle=i||this.colors.rect,this.ctx.fillRect(e,t,n,c)}},{key:"w",value:function(){return this.canvas.width}},{key:"h",value:function(){return this.canvas.height}},{key:"setColors",value:function(e){this.colors=Object(T.a)(Object(T.a)({},this.colors),e)}}]),e}()),w={id:null,position:{x:null,y:null},color:x,alive:!0},C={},I={},A={},R=0,M=!1,L=function(e){var t=w.position.x,n=w.position.y,c=e.x<=t&&t<e.x+e.width,i=e.y<=n&&n<e.y+e.height;return c&&i},D=function(e,t){var n=e.x===t.x&&e.y===t.y,c=e.x===t.x&&e.y-p.STEP===t.y,i=e.x===t.x&&e.y+p.STEP===t.y,o=e.x-p.STEP===t.x&&e.y===t.y,a=e.x+p.STEP===t.x&&e.y===t.y;return n||c||i||o||a},F=function(e){C=e},H=null,K=function(){w.alive&&(w.alive=!1,H&&H())},_=function(e){M=e},G=0,q=0,Y=function(){requestAnimationFrame((function e(t){q=(t-G)/16,G=t,M||(P.clear(),function(){for(var e=Object.keys(A),t=0;t<e.length;t++){var n=e[t],c=A[n],i=c.x,o=c.y,a=c.color;P.rect(i,o,p.STEP,p.STEP,a)}}(),function(){for(var e in C){var t=C[e];w.id!==t.id&&t.alive&&(D(t.position,w)&&console.log("TOUCHING PLAYERS"),P.rect(t.position.x,t.position.y,p.STEP,p.STEP,t.color))}}(),function(){if(w.alive){var e=w.position,t=e.x,n=e.y;P.rect(t,n,p.STEP,p.STEP,w.color)}}(),function(){var e=w.position.x,t=w.position.y;(e<R*p.STEP||e>=v-R*p.STEP||t<R*p.STEP||t>=h-R*p.STEP)&&K()}(),function(e){var t,n=Object.keys(I);n.length>100&&console.log("BLOCKS array is getting quite large! @ ",n.length);for(var c=0;c<n.length;c++){var i=n[c];I[i].x+=I[i].velocity.x*e,I[i].y+=I[i].velocity.y*e,I[i].age+=e,t=I[i],P.rect(t.x,t.y,t.width,t.height,t.color),L(I[i])&&K(),I[i].age>m&&delete I[i]}}(q)),requestAnimationFrame(e)}))},z=function(e){var t=e.id,n=e.players,c=e.children,i=e.color,o=e.onChange,a=function(e){o&&o(e.target.value)};return Object(b.jsxs)("div",{className:"lobby flex-col flex-fill",children:[Object(b.jsx)("div",{className:"player-list flex-col",children:null===n||void 0===n?void 0:n.map((function(e){var n=e.id===t,c=n?{color:i}:null,o=n?" bold":"",l=n?Object(b.jsxs)("span",{children:[" ",Object(b.jsx)("input",{type:"color",value:i,onChange:a})," "]}):null;return Object(b.jsxs)("label",{className:"flex medium"+o,style:c,children:[" ",e.nickname," ",l," "]},e.id)}))}),c]})},B=function(e){var t=e.width,n=e.height,i=e.onMouseMove,o=e.onKey,a=e.zoomMultiplier,l=e.className,s=Object(c.useRef)(null),r=Object(c.useRef)(null);Object(c.useEffect)((function(){s.current&&(s.current.focus(),function(e){P.init(e),P.clear()}(s),Y())}),[t,n]);var u={transform:"scale(".concat(v/(v-a*O*2),")")};return Object(b.jsx)("div",{className:"canvas-wrapper",children:Object(b.jsx)("canvas",{className:l||"",width:v,height:h,onMouseMove:function(e){if(i){var t=e.clientX,n=e.clientY,c=e.target,o=c.offsetTop,a=t-c.offsetLeft,l=n-o;r.current={x:a,y:l},i&&i(r.current)}},onKeyDown:function(e){o&&o(e.key)},onContextMenu:function(e){e.preventDefault()},tabIndex:1,ref:s,style:u})})},U=function(e){var t=e.onPress,n=function(e){var n=e.target.id;t&&t(n)};return Object(b.jsxs)("div",{className:"flex mobile controls",children:[Object(b.jsx)("button",{id:"a",onClick:n}),Object(b.jsxs)("div",{className:"flex-col",children:[Object(b.jsx)("button",{id:"w",onClick:n}),Object(b.jsx)("button",{id:"s",onClick:n})]}),Object(b.jsx)("button",{id:"d",onClick:n})]})},J=function(e){var t=e.name,n=Object(r.i)().room,i=Object(c.useState)(0),o=Object(l.a)(i,2),a=o[0],s=o[1],u=Object(c.useState)(null),d=Object(l.a)(u,2),j=d[0],f=d[1],v=Object(c.useState)(null),h=Object(l.a)(v,2),O=h[0],m=h[1],y=Object(c.useState)(x),S=Object(l.a)(y,2),k=S[0],N=S[1],P=Object(c.useState)(null),C=Object(l.a)(P,2),L=C[0],D=C[1],K=Object(c.useState)(0),G=Object(l.a)(K,2),q=G[0],Y=G[1],J=Object(c.useState)(null),W=Object(l.a)(J,2),X=W[0],Q=W[1],V=Object(c.useState)(null),Z=Object(l.a)(V,2),$=Z[0],ee=Z[1],te=Object(c.useState)(!1),ne=Object(l.a)(te,2),ce=ne[0],ie=ne[1];Object(c.useEffect)((function(){t&&(E.emit("SET_NICK",t),E.emit("JOIN_ROOM",n),E.on("START_GAME",(function(){s(1),ie(!1),_(!1)})),E.on("ROOM_UPDATE",(function(e){var t,n;e.end&&(ee(e.message),_(!0),ie(!0),w=Object(T.a)(Object(T.a)({},w),{},{alive:!0}),I={},A={},R=0),f(null===e||void 0===e?void 0:e.host),m(null===e||void 0===e?void 0:e.playersList),F(null===e||void 0===e?void 0:e.players),n=null===e||void 0===e||null===(t=e.players[E.id])||void 0===t?void 0:t.position,w.position=n,(null===e||void 0===e?void 0:e.difficulty)>0&&s(1)})),E.on("GENERATION",(function(e){var t;t=e,I=Object(T.a)(Object(T.a)({},null===t||void 0===t?void 0:t.blocks),I),A=null===t||void 0===t?void 0:t.pickups,R=null===t||void 0===t?void 0:t.limit,Y(null===e||void 0===e?void 0:e.limit),D(null===e||void 0===e?void 0:e.alive)})),E.on("POSITIONS",F))}),[n,t]),Object(c.useEffect)((function(){var e;e={id:E.id},w=Object(T.a)(Object(T.a)({},w),e),H=se}),[]);var oe=function(){E.emit("START_GAME")},ae=function(e){var t=function(e){if(w.alive&&!M)return"w"!==e&&"ArrowUp"!==e||(w.position.y-=p.STEP),"s"!==e&&"ArrowDown"!==e||(w.position.y+=p.STEP),"a"!==e&&"ArrowLeft"!==e||(w.position.x-=p.STEP),"d"!==e&&"ArrowRight"!==e||(w.position.x+=p.STEP),w.position}(e);t&&E.emit("PLAYER_POSITION",t)},le=function(e){N(e),function(e){w.color=e}(e),E.emit("PLAYER_COLOR",e)},se=function(){E.emit("PLAYER_DEATH"),Q("animate-shake"),setTimeout((function(){Q(null)}),500)},re=function(){ie(!1),s(0),Y(0),_(!1)};if(!t)return Object(b.jsx)(r.a,{to:"/".concat(n,"/@")});var ue="room flex-col flex-fill"+(1===a?" dark":"");return Object(b.jsx)("div",{className:ue,children:1===a?Object(b.jsxs)(b.Fragment,{children:[ce&&Object(b.jsxs)("div",{className:"end-screen flex-col",children:[Object(b.jsxs)("label",{className:"huge bold",children:[" ",$," "]}),Object(b.jsx)("button",{className:"round-btn large bold",onClick:re,children:" back to lobby "})]}),Object(b.jsxs)("div",{className:"game flex-col flex-fill",children:[Object(b.jsxs)("label",{className:"large bold center-text",children:[" ",L," player",L>1?"s":""," remaining "]}),Object(b.jsx)(B,{className:X,onKey:ae,zoomMultiplier:q}),Object(b.jsx)(U,{onPress:ae})]})]}):Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("label",{className:"large bold center-text",children:[" ",g,"/",n," "]}),Object(b.jsx)(z,{id:E.id,players:O,color:k,onChange:le,children:(null===j||void 0===j?void 0:j.id)===E.id&&Object(b.jsx)("button",{className:"round-btn large bold",onClick:oe,children:" start "})})]})})},W=function(){var e=Object(c.useState)(null),t=Object(l.a)(e,2),n=t[0],i=t[1];return Object(c.useEffect)((function(){d.a.attach(document.body)}),[]),Object(b.jsx)("div",{className:"app",children:Object(b.jsx)(s.a,{children:Object(b.jsxs)(r.d,{children:[Object(b.jsx)(r.b,{path:"/",element:Object(b.jsx)(f,{name:n,setName:i})}),Object(b.jsx)(r.b,{path:"/:room/@",element:Object(b.jsx)(f,{name:n,setName:i})}),Object(b.jsx)(r.b,{path:"/:room",element:Object(b.jsx)(J,{name:n})})]})})})},X=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,83)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),c(e),i(e),o(e),a(e)}))};a.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(W,{})}),document.getElementById("root")),X()}},[[82,1,2]]]);
//# sourceMappingURL=main.ab4e7858.chunk.js.map