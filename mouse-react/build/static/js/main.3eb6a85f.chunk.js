(this["webpackJsonpblock-react"]=this["webpackJsonpblock-react"]||[]).push([[0],{45:function(e,t,n){},46:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var i=n(0),c=n.n(i),o=n(37),a=n.n(o),l=(n(45),n(3)),s=(n(46),n(14)),r=n(2),u=n(1),d="text-input large bold",v=function(e){var t=e.name,n=e.setName,c=Object(r.i)().room,o=Object(i.useState)(null),a=Object(l.a)(o,2),v=a[0],b=a[1],j=Object(i.useState)(c),h=Object(l.a)(j,2),f=h[0],O=h[1];Object(i.useEffect)((function(){document.title=c||"block"}),[c]);var m=function(e){"Enter"===e.key&&t&&f&&b(Object(u.jsx)(r.a,{to:"/".concat(f)}))};return v||Object(u.jsxs)("div",{className:"home",children:[Object(u.jsx)("input",{className:d,type:"text",placeholder:"name",onChange:function(e){n(e.target.value)},onKeyPress:c?m:null,autoFocus:!0}),!c&&Object(u.jsx)("input",{className:d+(t||f?"":" hide"),type:"text",placeholder:"room code",onChange:function(e){O(e.target.value)},onKeyPress:c?m:null}),Object(u.jsx)(s.b,{className:"round-btn medium"+(t&&f?"":" hide"),to:"/".concat(f),children:" join "})]})},b=735,j=735,h=15,f="#3c3cff",O=500,m={WIDTH:b/h,HEIGHT:j/h,STEP:h};Math.floor(m.WIDTH/2),Math.floor(m.HEIGHT/2);(b%h||b%h)&&console.warn("Height or width must be divisible by step");var x=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_DEV,p="https://block10.herokuapp.com",y=x?"http://localhost:3000":p,S=x?"http://localhost:3300":p,g=null===y||void 0===y?void 0:y.replace("http://","").replace("https://","");console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}));var E=n(38),T=S,P=n.n(E)()(T,{transports:["websocket"]}),N=n(10),C=n(39),k=n(40),w=new(function(){function e(){Object(C.a)(this,e),this.canvas=null,this.ctx=null,this.img=new Image,this.update=!1,this.colors={clear:"WHITE",rect:"BLACK"}}return Object(k.a)(e,[{key:"init",value:function(e){(null===e||void 0===e?void 0:e.current)?(console.log("Initializing Canvas"),this.canvas=e.current,this.parent=e.current.parentElement,this.ctx=this.canvas.getContext("2d"),this.clear()):console.log("Could not initialize Canvas")}},{key:"clear",value:function(){this.canvas&&(this.ctx.fillStyle=this.colors.clear,this.ctx.fillRect(0,0,this.w(),this.h()))}},{key:"getData",value:function(){if(this.canvas)return this.canvas.toDataURL()}},{key:"setData",value:function(e){var t=this;if(this.canvas){var n=new Image;n.onload=function(){t.ctx.drawImage(n,0,0,t.canvas.width,t.canvas.height)},this.img.src=e,this.update=!0}}},{key:"draw",value:function(){var e=this;if(this.canvas){requestAnimationFrame((function t(){e.update&&(e.update=!1,e.ctx.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)),requestAnimationFrame(t)}))}}},{key:"rect",value:function(e,t,n,i,c){this.ctx.fillStyle=c||this.colors.rect,this.ctx.fillRect(e,t,n,i)}},{key:"w",value:function(){return this.canvas.width}},{key:"h",value:function(){return this.canvas.height}},{key:"setColors",value:function(e){this.colors=Object(N.a)(Object(N.a)({},this.colors),e)}}]),e}()),_={id:null,position:{x:null,y:null},color:f,alive:!0},A={},R={},I={},D=0,L=!1,H=function(e){var t=_.position.x,n=_.position.y,i=e.x<=t&&t<e.x+e.width,c=e.y<=n&&n<e.y+e.height;return i&&c},F=function(e,t){var n=e.x===t.x&&e.y===t.y,i=e.x===t.x&&e.y-m.STEP===t.y,c=e.x===t.x&&e.y+m.STEP===t.y,o=e.x-m.STEP===t.x&&e.y===t.y,a=e.x+m.STEP===t.x&&e.y===t.y;return n||i||c||o||a},K=function(e){A=e},M=null,W=function(){_.alive&&(_.alive=!1,M&&M())},U=function(e){L=e},B=0,G=0,q=function(){requestAnimationFrame((function e(t){G=(t-B)/16,B=t,L||(w.clear(),function(){for(var e=Object.keys(I),t=0;t<e.length;t++){var n=e[t],i=I[n],c=i.x,o=i.y,a=i.color;w.rect(c,o,m.STEP,m.STEP,a)}}(),function(){for(var e in A){var t=A[e];_.id!==t.id&&t.alive&&(F(t.position,_)&&console.log("TOUCHING PLAYERS"),w.rect(t.position.x,t.position.y,m.STEP,m.STEP,t.color))}}(),function(){if(_.alive){var e=_.position,t=e.x,n=e.y;w.rect(t,n,m.STEP,m.STEP,_.color)}}(),function(){var e=_.position.x,t=_.position.y;(e<D*m.STEP||e>=b-D*m.STEP||t<D*m.STEP||t>=j-D*m.STEP)&&W()}(),function(e){var t,n=Object.keys(R);n.length>100&&console.log("BLOCKS array is getting quite large! @ ",n.length);for(var i=0;i<n.length;i++){var c=n[i];R[c].x+=R[c].velocity.x*e,R[c].y+=R[c].velocity.y*e,R[c].age+=e,t=R[c],w.rect(t.x,t.y,t.width,t.height,t.color),H(R[c])&&W(),R[c].age>O&&delete R[c]}}(G)),requestAnimationFrame(e)}))},Y=function(e){var t=e.id,n=e.players,i=e.children,c=e.color,o=e.onChange,a=function(e){o&&o(e.target.value)};return Object(u.jsxs)("div",{className:"lobby flex-col flex-fill",children:[Object(u.jsx)("div",{className:"player-list flex-col",children:null===n||void 0===n?void 0:n.map((function(e){var n=e.id===t,i=n?{color:c}:null,o=n?" bold":"",l=n?Object(u.jsxs)("span",{children:[" ",Object(u.jsx)("input",{type:"color",value:c,onChange:a})," "]}):null;return Object(u.jsxs)("label",{className:"flex medium"+o,style:i,children:[" ",e.nickname," ",l," "]},e.id)}))}),i]})},z=function(e){var t=e.width,n=e.height,c=e.onMouseMove,o=e.onKey,a=e.zoomMultiplier,l=e.className,s=Object(i.useRef)(null),r=Object(i.useRef)(null);Object(i.useEffect)((function(){s.current&&(s.current.focus(),function(e){w.init(e),w.clear()}(s),q())}),[t,n]);var d={transform:"scale(".concat(b/(b-a*h*2),")")};return Object(u.jsx)("div",{className:"canvas-wrapper",children:Object(u.jsx)("canvas",{className:l||"",width:b,height:j,onMouseMove:function(e){if(c){var t=e.clientX,n=e.clientY,i=e.target,o=i.offsetTop,a=t-i.offsetLeft,l=n-o;r.current={x:a,y:l},c&&c(r.current)}},onKeyDown:function(e){o&&o(e.key)},onContextMenu:function(e){e.preventDefault()},tabIndex:1,ref:s,style:d})})},J=function(e){var t=e.name,n=Object(r.i)().room,c=Object(i.useState)(0),o=Object(l.a)(c,2),a=o[0],s=o[1],d=Object(i.useState)(null),v=Object(l.a)(d,2),b=v[0],j=v[1],h=Object(i.useState)(null),O=Object(l.a)(h,2),x=O[0],p=O[1],y=Object(i.useState)(f),S=Object(l.a)(y,2),E=S[0],T=S[1],C=Object(i.useState)(null),k=Object(l.a)(C,2),w=k[0],A=k[1],H=Object(i.useState)(0),F=Object(l.a)(H,2),W=F[0],B=F[1],G=Object(i.useState)(null),q=Object(l.a)(G,2),J=q[0],V=q[1],X=Object(i.useState)(null),Q=Object(l.a)(X,2),Z=Q[0],$=Q[1],ee=Object(i.useState)(!1),te=Object(l.a)(ee,2),ne=te[0],ie=te[1];Object(i.useEffect)((function(){t&&(P.emit("SET_NICK",t),P.emit("JOIN_ROOM",n),P.on("START_GAME",(function(){s(1),ie(!1),U(!1)})),P.on("ROOM_UPDATE",(function(e){var t,n;e.end&&($(e.message),U(!0),ie(!0),_=Object(N.a)(Object(N.a)({},_),{},{alive:!0}),R={},I={},D=0),j(null===e||void 0===e?void 0:e.host),p(null===e||void 0===e?void 0:e.playersList),K(null===e||void 0===e?void 0:e.players),n=null===e||void 0===e||null===(t=e.players[P.id])||void 0===t?void 0:t.position,_.position=n,(null===e||void 0===e?void 0:e.difficulty)>0&&s(1)})),P.on("GENERATION",(function(e){var t;t=e,R=Object(N.a)(Object(N.a)({},null===t||void 0===t?void 0:t.blocks),R),I=null===t||void 0===t?void 0:t.pickups,D=null===t||void 0===t?void 0:t.limit,B(null===e||void 0===e?void 0:e.limit),A(null===e||void 0===e?void 0:e.alive)})),P.on("POSITIONS",K))}),[n,t]),Object(i.useEffect)((function(){var e;e={id:P.id},_=Object(N.a)(Object(N.a)({},_),e),M=le}),[]);var ce=function(){P.emit("START_GAME")},oe=function(e){var t=function(e){if(_.alive&&!L)return"w"!==e&&"ArrowUp"!==e||(_.position.y-=m.STEP),"s"!==e&&"ArrowDown"!==e||(_.position.y+=m.STEP),"a"!==e&&"ArrowLeft"!==e||(_.position.x-=m.STEP),"d"!==e&&"ArrowRight"!==e||(_.position.x+=m.STEP),_.position}(e);t&&P.emit("PLAYER_POSITION",t)},ae=function(e){T(e),function(e){_.color=e}(e),P.emit("PLAYER_COLOR",e)},le=function(){P.emit("PLAYER_DEATH"),V("animate-shake"),setTimeout((function(){V(null)}),500)},se=function(){ie(!1),s(0),B(0),U(!1)};if(!t)return Object(u.jsx)(r.a,{to:"/".concat(n,"/@")});var re="room flex-col flex-fill"+(1===a?" dark":"");return Object(u.jsx)("div",{className:re,children:1===a?Object(u.jsxs)(u.Fragment,{children:[ne&&Object(u.jsxs)("div",{className:"end-screen flex-col",children:[Object(u.jsxs)("label",{className:"huge bold",children:[" ",Z," "]}),Object(u.jsx)("button",{className:"round-btn large bold",onClick:se,children:" back to lobby "})]}),Object(u.jsxs)("label",{className:"large bold",children:[" ",w," player",w>1?"s":""," remaining "]}),Object(u.jsx)(z,{className:J,onKey:oe,zoomMultiplier:W})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("label",{className:"large bold",children:[" ",g,"/",n," "]}),Object(u.jsx)(Y,{id:P.id,players:x,color:E,onChange:ae,children:(null===b||void 0===b?void 0:b.id)===P.id&&Object(u.jsx)("button",{className:"round-btn large bold",onClick:ce,children:" start "})})]})})},V=function(){var e=Object(i.useState)(null),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(u.jsx)("div",{className:"app",children:Object(u.jsx)(s.a,{children:Object(u.jsxs)(r.d,{children:[Object(u.jsx)(r.b,{path:"/",element:Object(u.jsx)(v,{name:n,setName:c})}),Object(u.jsx)(r.b,{path:"/:room/@",element:Object(u.jsx)(v,{name:n,setName:c})}),Object(u.jsx)(r.b,{path:"/:room",element:Object(u.jsx)(J,{name:n})})]})})})},X=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,82)).then((function(t){var n=t.getCLS,i=t.getFID,c=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),i(e),c(e),o(e),a(e)}))};a.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(V,{})}),document.getElementById("root")),X()}},[[81,1,2]]]);
//# sourceMappingURL=main.3eb6a85f.chunk.js.map