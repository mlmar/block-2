(this["webpackJsonpblock-react"]=this["webpackJsonpblock-react"]||[]).push([[0],{45:function(e,t,n){},46:function(e,t,n){},81:function(e,t,n){"use strict";n.r(t);var o=n(0),c=n.n(o),i=n(37),l=n.n(i),a=(n(45),n(3)),s=(n(46),n(14)),r=n(2),u=n(1),b="text-input large bold",d=function(e){var t=e.name,n=e.setName,c=Object(r.i)().room,i=Object(o.useState)(null),l=Object(a.a)(i,2),d=l[0],j=l[1],h=Object(o.useState)(c),f=Object(a.a)(h,2),v=f[0],x=f[1];Object(o.useEffect)((function(){document.title=c||"block"}),[c]);var m=function(e){"Enter"===e.key&&t&&v&&j(Object(u.jsx)(r.a,{to:"/".concat(v)}))};return d||Object(u.jsxs)("div",{className:"home",children:[Object(u.jsx)("input",{className:b,type:"text",placeholder:"name",onChange:function(e){n(e.target.value)},onKeyPress:c?m:null,autoFocus:!0}),!c&&Object(u.jsx)("input",{className:b+(t||v?"":" hide"),type:"text",placeholder:"room code",onChange:function(e){x(e.target.value)},onKeyPress:c?m:null}),Object(u.jsx)(s.b,{className:"round-btn medium"+(t&&v?"":" hide"),to:"/".concat(v),children:" join "})]})},j=735,h=735,f=15,v="#03a9f4",x=500,m={WIDTH:j/f,HEIGHT:h/f,STEP:f};Math.floor(m.WIDTH/2),Math.floor(m.HEIGHT/2);(j%f||j%f)&&console.warn("Height or width must be divisible by step");var O=n(38),p=n.n(O),y="https://block10.herokuapp.com",g=y,S=(null===g||void 0===g||g.replace("http://","").replace("https://",""),p()("https://block10.herokuapp.com",{transports:["websocket"]})),A=n(10),E=n(39),T=n(40),N=new(function(){function e(){Object(E.a)(this,e),this.canvas=null,this.ctx=null,this.img=new Image,this.update=!1,this.colors={clear:"WHITE",rect:"BLACK"}}return Object(T.a)(e,[{key:"init",value:function(e){(null===e||void 0===e?void 0:e.current)?(console.log("Initializing Canvas"),this.canvas=e.current,this.parent=e.current.parentElement,this.ctx=this.canvas.getContext("2d"),this.clear()):console.log("Could not initialize Canvas")}},{key:"clear",value:function(){this.canvas&&(this.ctx.fillStyle=this.colors.clear,this.ctx.fillRect(0,0,this.w(),this.h()))}},{key:"getData",value:function(){if(this.canvas)return this.canvas.toDataURL()}},{key:"setData",value:function(e){var t=this;if(this.canvas){var n=new Image;n.onload=function(){t.ctx.drawImage(n,0,0,t.canvas.width,t.canvas.height)},this.img.src=e,this.update=!0}}},{key:"draw",value:function(){var e=this;if(this.canvas){requestAnimationFrame((function t(){e.update&&(e.update=!1,e.ctx.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)),requestAnimationFrame(t)}))}}},{key:"rect",value:function(e,t,n,o,c){this.ctx.fillStyle=c||this.colors.rect,this.ctx.fillRect(e,t,n,o)}},{key:"outline",value:function(e,t,n,o,c){this.ctx.translate(.5,.5),this.ctx.strokeStyle=c||this.colors.rect,this.ctx.lineWidth=2,this.ctx.strokeRect(e,t,n,o),this.ctx.setTransform(1,0,0,1,0,0)}},{key:"w",value:function(){return this.canvas.width}},{key:"h",value:function(){return this.canvas.height}},{key:"setColors",value:function(e){this.colors=Object(A.a)(Object(A.a)({},this.colors),e)}}]),e}()),k={id:null,position:{x:null,y:null},color:v,alive:!0},P={},C={},w={},R={},I=0,L=!1,M=function(e){var t=k.position.x,n=k.position.y,o=e.x<=t&&t<e.x+e.width,c=e.y<=n&&n<e.y+e.height;return o&&c},K=function(e,t){var n=e.x===t.x&&e.y===t.y,o=e.x===t.x&&e.y-m.STEP===t.y,c=e.x===t.x&&e.y+m.STEP===t.y,i=e.x-m.STEP===t.x&&e.y===t.y,l=e.x+m.STEP===t.x&&e.y===t.y;return n||o||c||i||l},Y=function(e){k=Object(A.a)(Object(A.a)({},k),e)},D=function(e){P=e},H=null,B=function(){k.alive&&(k.alive=!1,H&&H())},F=function(e){L=e},G=0,J=0,q=function(){requestAnimationFrame((function e(t){J=(t-G)/16,G=t,L||(N.clear(),function(){for(var e=Object.keys(w),t=0;t<e.length;t++){var n=e[t],o=w[n],c=o.x,i=o.y,l=o.color;N.rect(c,i,m.STEP,m.STEP,l)}}(),function(){for(var e in P){var t,n=P[e];k.id!==n.id&&n.alive&&(K(n.position,k)&&console.log("TOUCHING PLAYERS"),N.rect(n.position.x,n.position.y,m.STEP,m.STEP,n.color),(null===(t=R)||void 0===t?void 0:t.id)===n.id&&N.outline(n.position.x,n.position.y,m.STEP,m.STEP,"RED"))}}(),function(){var e;if(k.alive){var t=k.position,n=t.x,o=t.y;N.rect(n,o,m.STEP,m.STEP,k.color),(null===(e=R)||void 0===e?void 0:e.id)===k.id&&N.outline(n,o,m.STEP,m.STEP,"RED")}}(),function(){var e=k.position.x,t=k.position.y;(e<I*m.STEP||e>=j-I*m.STEP||t<I*m.STEP||t>=h-I*m.STEP)&&B()}(),function(e){var t,n=Object.keys(C);n.length>100&&console.log("BLOCKS array is getting quite large! @ ",n.length);for(var o=0;o<n.length;o++){var c=n[o];C[c].x+=C[c].velocity.x*e,C[c].y+=C[c].velocity.y*e,C[c].age+=e,t=C[c],N.rect(t.x,t.y,t.width,t.height,t.color),M(C[c])&&B(),C[c].age>x&&delete C[c]}}(J)),requestAnimationFrame(e)}))},Q=function(){var e=Object(o.useState)(!0),t=Object(a.a)(e,2),n=t[0],c=t[1];return n?Object(u.jsxs)("div",{className:"instructions flex-col",children:[Object(u.jsx)("label",{className:"large bold",children:" how to play "}),Object(u.jsxs)("div",{className:"flex-col",children:[Object(u.jsxs)("p",{className:"small bold",children:[" \u2022 A random player starts off as the ",Object(u.jsx)("span",{children:"bomb"}),". "]}),Object(u.jsx)("p",{className:"small bold",children:" \u2022 Touch a yellow square to transfer the bomb to someone else before the timer runs out. "}),Object(u.jsx)("p",{className:"small bold",children:" \u2022 Anyone can steal yellow squares from the bomb. "}),Object(u.jsx)("p",{className:"small bold",children:" \u2022 Careful \u2014 the board gets smaller over time and you can get crushed by moving blocks. "})]}),Object(u.jsx)("button",{className:"round-btn large bold",onClick:function(){c(!1)},children:" ok "})]}):null},W=function(e){var t=e.id,n=e.players,o=e.children,c=e.color,i=e.onChange,l=function(e){i&&i(e.target.value)};return Object(u.jsxs)("div",{className:"lobby flex-col flex-fill",children:[Object(u.jsx)("div",{className:"player-list flex-col",children:null===n||void 0===n?void 0:n.map((function(e){var n=e.id===t,o={color:e.color},i=n?" bold":"",a=n?Object(u.jsxs)("span",{children:[" ",Object(u.jsx)("input",{type:"color",value:c,onChange:l})," "]}):null;return Object(u.jsxs)("label",{className:"flex medium"+i,style:o,children:[" ",e.nickname," ",a," "]},e.id)}))}),o]})},z=function(e){var t=e.width,n=e.height,c=e.onMouseMove,i=e.onKey,l=e.zoomMultiplier,a=e.className,s=Object(o.useRef)(null),r=Object(o.useRef)(null);Object(o.useEffect)((function(){s.current&&(s.current.focus(),function(e){N.init(e),N.clear()}(s),q())}),[t,n]);var b={transform:"scale(".concat(j/(j-l*f*2),")")};return Object(u.jsx)("div",{className:"canvas-wrapper",children:Object(u.jsx)("canvas",{className:a||"",width:j,height:h,onMouseMove:function(e){if(c){var t=e.clientX,n=e.clientY,o=e.target,i=o.offsetTop,l=t-o.offsetLeft,a=n-i;r.current={x:l,y:a},c&&c(r.current)}},onKeyDown:function(e){i&&i(e.key)},onContextMenu:function(e){e.preventDefault()},tabIndex:1,ref:s,style:b})})},_=function(e){var t=e.onPress,n=function(e){var n=e.target.id;t&&t(n)};return Object(u.jsxs)("div",{className:"flex mobile controls",children:[Object(u.jsx)("button",{id:"a",onTouchStart:n}),Object(u.jsxs)("div",{className:"flex-col",children:[Object(u.jsx)("button",{id:"w",onTouchStart:n}),Object(u.jsx)("button",{id:"s",onTouchStart:n})]}),Object(u.jsx)("button",{id:"d",onTouchStart:n})]})},U=function(e){var t=e.room,n=function(){return Object(u.jsxs)("span",{className:"flex",children:[" ",Object(u.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABmJLR0QA/wD/AP+gvaeTAAABHElEQVRoge3YQQrCMBCF4b/iFSriRd16xiKKp9GVNLWt0sxLMsg8KK46k89MAy1o8xRdd+AoXtumqCDNMe9FKGo0xSghQ/LbG2tmL0JRo2fEVN8ZJQQaYs5oIdAQczHev7SrKWb1mVEdlzc0/9baeP7EKM/+B3AqBPnEzMZMffZbMb/Ws4pRQu5LDTJrfcvimCkhR+yYnJEe0hstSWscgCv5Y5b7fMohYMdk9S4BgXqY4hCog6kCgfKYahAoi6kKgXKYIpAt183Yc9K7Y0R0xmI5sfSc9N4LCsH2BVknYJadumCrBMRbAuItAfGWgHhLQLwlIN4SEG8JiLeo3hCtMb8xxo6IY/4I8Tc7EhBvCYi3pKeW/OtfzfzNjrwAb3YJtHLIRU8AAAAASUVORK5CYII=",alt:"clipboard"})," "]})};return Object(u.jsxs)("label",{className:"clipboard flex large bold",title:"copy room to clipboard",onClick:function(){var e=g+"/"+t;navigator.clipboard.writeText(e)},children:[" ",t," ",Object(u.jsx)(n,{})," "]})},V=function(e){var t=e.name,n=Object(r.i)().room,c=Object(o.useState)(0),i=Object(a.a)(c,2),l=i[0],s=i[1],b=Object(o.useState)(null),d=Object(a.a)(b,2),j=d[0],h=d[1],f=Object(o.useState)(null),x=Object(a.a)(f,2),O=x[0],p=x[1],y=Object(o.useState)(v),g=Object(a.a)(y,2),E=g[0],T=g[1],N=Object(o.useState)(null),P=Object(a.a)(N,2),M=P[0],K=P[1],B=Object(o.useState)(0),G=Object(a.a)(B,2),J=G[0],q=G[1],V=Object(o.useState)(null),X=Object(a.a)(V,2),Z=X[0],$=X[1],ee=Object(o.useState)(null),te=Object(a.a)(ee,2),ne=te[0],oe=te[1],ce=Object(o.useState)(!1),ie=Object(a.a)(ce,2),le=ie[0],ae=ie[1];Object(o.useEffect)((function(){t&&(S.emit("SET_NICK",t),S.emit("JOIN_ROOM",n),S.on("START_GAME",(function(){s(1),ae(!1),F(!1)})),S.on("ROOM_UPDATE",(function(e){var t,n;e.end&&(oe(e.message),F(!0),ae(!0),k=Object(A.a)(Object(A.a)({},k),{},{alive:!0}),C={},w={},R={},I=0),h(null===e||void 0===e?void 0:e.host),p(null===e||void 0===e?void 0:e.playersList),D(null===e||void 0===e?void 0:e.players),n=null===e||void 0===e||null===(t=e.players[S.id])||void 0===t?void 0:t.position,k.position=n,(null===e||void 0===e?void 0:e.difficulty)>0&&s(1)})),S.on("GENERATION",(function(e){var t;t=e,C=Object(A.a)(Object(A.a)({},null===t||void 0===t?void 0:t.blocks),C),w=null===t||void 0===t?void 0:t.pickups,R=null===t||void 0===t?void 0:t.bomb,I=null===t||void 0===t?void 0:t.limit,q(null===e||void 0===e?void 0:e.limit),K(e.bomb)})),S.on("POSITIONS",D),S.on("PLAYER_COLORS",(function(e){p(e.playersList),D(e.players)})),S.on("EXPLODE",(function(){Y({alive:!1}),be()})))}),[n,t]),Object(o.useEffect)((function(){Y({id:S.id}),H=function(){S.emit("PLAYER_DEATH"),be()}}),[]);var se=function(){S.emit("START_GAME")},re=function(e){var t=function(e){if(k.alive&&!L)return"w"!==e&&"ArrowUp"!==e||(k.position.y-=m.STEP),"s"!==e&&"ArrowDown"!==e||(k.position.y+=m.STEP),"a"!==e&&"ArrowLeft"!==e||(k.position.x-=m.STEP),"d"!==e&&"ArrowRight"!==e||(k.position.x+=m.STEP),k.position}(e);t&&S.emit("PLAYER_POSITION",t)},ue=function(e){T(e),function(e){k.color=e}(e),S.emit("PLAYER_COLOR",e)},be=function(){$("animate-shake"),setTimeout((function(){$(null)}),500)},de=function(){ae(!1),K(0),s(0),q(0),F(!1)};if(!t)return Object(u.jsx)(r.a,{to:"/".concat(n,"/@")});var je="room flex-col flex-fill"+(1===l?" dark":"");return Object(u.jsxs)("div",{className:je,children:[Object(u.jsx)(Q,{}),1===l?Object(u.jsxs)("div",{className:"game flex-col flex-fill",children:[le&&Object(u.jsxs)("div",{className:"end-screen flex-col",children:[Object(u.jsxs)("label",{className:"huge bold",children:[" ",ne," "]}),Object(u.jsx)("button",{className:"round-btn large bold",onClick:de,children:" back to lobby "})]}),Object(u.jsxs)("label",{className:"large bold center-text",children:[" ",null===M||void 0===M?void 0:M.timer," ",Object(u.jsx)(u.Fragment,{children:" \u2014 "})," ",null===M||void 0===M?void 0:M.nickname," "]}),Object(u.jsx)(z,{className:Z,onKey:re,zoomMultiplier:J}),Object(u.jsx)(_,{onPress:re})]}):Object(u.jsxs)("div",{className:"flex-col flex-fill",children:[Object(u.jsx)(U,{room:n}),Object(u.jsx)(W,{id:S.id,players:O,color:E,onChange:ue,children:(null===j||void 0===j?void 0:j.id)===S.id&&Object(u.jsx)("button",{className:"round-btn large bold",onClick:se,children:" start "})})]})]})},X=function(){var e=Object(o.useState)(null),t=Object(a.a)(e,2),n=t[0],c=t[1];return Object(u.jsx)("div",{className:"app",children:Object(u.jsx)(s.a,{children:Object(u.jsxs)(r.d,{children:[Object(u.jsx)(r.b,{path:"/",element:Object(u.jsx)(d,{name:n,setName:c})}),Object(u.jsx)(r.b,{path:"/:room/@",element:Object(u.jsx)(d,{name:n,setName:c})}),Object(u.jsx)(r.b,{path:"/:room",element:Object(u.jsx)(V,{name:n})})]})})})},Z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,82)).then((function(t){var n=t.getCLS,o=t.getFID,c=t.getFCP,i=t.getLCP,l=t.getTTFB;n(e),o(e),c(e),i(e),l(e)}))};l.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(X,{})}),document.getElementById("root")),Z()}},[[81,1,2]]]);
//# sourceMappingURL=main.a7859b03.chunk.js.map