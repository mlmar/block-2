(this["webpackJsonpblock-react"]=this["webpackJsonpblock-react"]||[]).push([[0],{46:function(e,t,n){},47:function(e,t,n){},82:function(e,t,n){"use strict";n.r(t);var c=n(0),i=n.n(c),o=n(37),a=n.n(o),l=(n(46),n(3)),s=(n(47),n(14)),r=n(2),u=n(1),d="text-input large bold",b=function(e){var t=e.name,n=e.setName,i=Object(r.i)().room,o=Object(c.useState)(null),a=Object(l.a)(o,2),b=a[0],j=a[1],f=Object(c.useState)(i),v=Object(l.a)(f,2),h=v[0],O=v[1];Object(c.useEffect)((function(){document.title=i||"block"}),[i]);var x=function(e){"Enter"===e.key&&t&&h&&j(Object(u.jsx)(r.a,{to:"/".concat(h)}))};return b||Object(u.jsxs)("div",{className:"home",children:[Object(u.jsx)("input",{className:d,type:"text",placeholder:"name",onChange:function(e){n(e.target.value)},onKeyPress:i?x:null,autoFocus:!0}),!i&&Object(u.jsx)("input",{className:d+(t||h?"":" hide"),type:"text",placeholder:"room code",onChange:function(e){O(e.target.value)},onKeyPress:i?x:null}),Object(u.jsx)(s.b,{className:"round-btn medium"+(t&&h?"":" hide"),to:"/".concat(h),children:" join "})]})},j=735,f=735,v=15,h="#3c3cff",O=500,x={WIDTH:j/v,HEIGHT:f/v,STEP:v};Math.floor(x.WIDTH/2),Math.floor(x.HEIGHT/2);(j%v||j%v)&&console.warn("Height or width must be divisible by step");var m="https://block10.herokuapp.com",p=null===m||void 0===m?void 0:m.replace("http://","").replace("https://",""),y=n(38),g=n.n(y)()("https://block10.herokuapp.com",{transports:["websocket"]}),S=n(10),E=n(39),T=n(40),k=new(function(){function e(){Object(E.a)(this,e),this.canvas=null,this.ctx=null,this.img=new Image,this.update=!1,this.colors={clear:"WHITE",rect:"BLACK"}}return Object(T.a)(e,[{key:"init",value:function(e){(null===e||void 0===e?void 0:e.current)?(console.log("Initializing Canvas"),this.canvas=e.current,this.parent=e.current.parentElement,this.ctx=this.canvas.getContext("2d"),this.clear()):console.log("Could not initialize Canvas")}},{key:"clear",value:function(){this.canvas&&(this.ctx.fillStyle=this.colors.clear,this.ctx.fillRect(0,0,this.w(),this.h()))}},{key:"getData",value:function(){if(this.canvas)return this.canvas.toDataURL()}},{key:"setData",value:function(e){var t=this;if(this.canvas){var n=new Image;n.onload=function(){t.ctx.drawImage(n,0,0,t.canvas.width,t.canvas.height)},this.img.src=e,this.update=!0}}},{key:"draw",value:function(){var e=this;if(this.canvas){requestAnimationFrame((function t(){e.update&&(e.update=!1,e.ctx.drawImage(e.img,0,0,e.canvas.width,e.canvas.height)),requestAnimationFrame(t)}))}}},{key:"rect",value:function(e,t,n,c,i){this.ctx.fillStyle=i||this.colors.rect,this.ctx.fillRect(e,t,n,c)}},{key:"w",value:function(){return this.canvas.width}},{key:"h",value:function(){return this.canvas.height}},{key:"setColors",value:function(e){this.colors=Object(S.a)(Object(S.a)({},this.colors),e)}}]),e}()),N={id:null,position:{x:null,y:null},color:h,alive:!0},P={},w={},C={},I=0,A=!1,R=function(e){var t=N.position.x,n=N.position.y,c=e.x<=t&&t<e.x+e.width,i=e.y<=n&&n<e.y+e.height;return c&&i},M=function(e,t){var n=e.x===t.x&&e.y===t.y,c=e.x===t.x&&e.y-x.STEP===t.y,i=e.x===t.x&&e.y+x.STEP===t.y,o=e.x-x.STEP===t.x&&e.y===t.y,a=e.x+x.STEP===t.x&&e.y===t.y;return n||c||i||o||a},L=function(e){P=e},D=null,F=function(){N.alive&&(N.alive=!1,D&&D())},H=function(e){A=e},K=0,_=0,G=function(){requestAnimationFrame((function e(t){_=(t-K)/16,K=t,A||(k.clear(),function(){for(var e=Object.keys(C),t=0;t<e.length;t++){var n=e[t],c=C[n],i=c.x,o=c.y,a=c.color;k.rect(i,o,x.STEP,x.STEP,a)}}(),function(){for(var e in P){var t=P[e];N.id!==t.id&&t.alive&&(M(t.position,N)&&console.log("TOUCHING PLAYERS"),k.rect(t.position.x,t.position.y,x.STEP,x.STEP,t.color))}}(),function(){if(N.alive){var e=N.position,t=e.x,n=e.y;k.rect(t,n,x.STEP,x.STEP,N.color)}}(),function(){var e=N.position.x,t=N.position.y;(e<I*x.STEP||e>=j-I*x.STEP||t<I*x.STEP||t>=f-I*x.STEP)&&F()}(),function(e){var t,n=Object.keys(w);n.length>100&&console.log("BLOCKS array is getting quite large! @ ",n.length);for(var c=0;c<n.length;c++){var i=n[c];w[i].x+=w[i].velocity.x*e,w[i].y+=w[i].velocity.y*e,w[i].age+=e,t=w[i],k.rect(t.x,t.y,t.width,t.height,t.color),R(w[i])&&F(),w[i].age>O&&delete w[i]}}(_)),requestAnimationFrame(e)}))},q=function(e){var t=e.id,n=e.players,c=e.children,i=e.color,o=e.onChange,a=function(e){o&&o(e.target.value)};return Object(u.jsxs)("div",{className:"lobby flex-col flex-fill",children:[Object(u.jsx)("div",{className:"player-list flex-col",children:null===n||void 0===n?void 0:n.map((function(e){var n=e.id===t,c=n?{color:i}:null,o=n?" bold":"",l=n?Object(u.jsxs)("span",{children:[" ",Object(u.jsx)("input",{type:"color",value:i,onChange:a})," "]}):null;return Object(u.jsxs)("label",{className:"flex medium"+o,style:c,children:[" ",e.nickname," ",l," "]},e.id)}))}),c]})},Y=function(e){var t=e.width,n=e.height,i=e.onMouseMove,o=e.onKey,a=e.zoomMultiplier,l=e.className,s=Object(c.useRef)(null),r=Object(c.useRef)(null);Object(c.useEffect)((function(){s.current&&(s.current.focus(),function(e){k.init(e),k.clear()}(s),G())}),[t,n]);var d={transform:"scale(".concat(j/(j-a*v*2),")")};return Object(u.jsx)("div",{className:"canvas-wrapper",children:Object(u.jsx)("canvas",{className:l||"",width:j,height:f,onMouseMove:function(e){if(i){var t=e.clientX,n=e.clientY,c=e.target,o=c.offsetTop,a=t-c.offsetLeft,l=n-o;r.current={x:a,y:l},i&&i(r.current)}},onKeyDown:function(e){o&&o(e.key)},onContextMenu:function(e){e.preventDefault()},tabIndex:1,ref:s,style:d})})},z=n(41),B=n.n(z),U=function(e){var t=e.onPress;Object(c.useEffect)((function(){B.a.attach(document.body)}),[]);var n=function(e){var n=e.target.id;t&&t(n)};return Object(u.jsxs)("div",{className:"flex mobile controls",children:[Object(u.jsx)("button",{id:"a",onClick:n}),Object(u.jsxs)("div",{className:"flex-col",children:[Object(u.jsx)("button",{id:"w",onClick:n}),Object(u.jsx)("button",{id:"s",onClick:n})]}),Object(u.jsx)("button",{id:"d",onClick:n})]})},J=function(e){var t=e.name,n=Object(r.i)().room,i=Object(c.useState)(0),o=Object(l.a)(i,2),a=o[0],s=o[1],d=Object(c.useState)(null),b=Object(l.a)(d,2),j=b[0],f=b[1],v=Object(c.useState)(null),O=Object(l.a)(v,2),m=O[0],y=O[1],E=Object(c.useState)(h),T=Object(l.a)(E,2),k=T[0],P=T[1],R=Object(c.useState)(null),M=Object(l.a)(R,2),F=M[0],K=M[1],_=Object(c.useState)(0),G=Object(l.a)(_,2),z=G[0],B=G[1],J=Object(c.useState)(null),W=Object(l.a)(J,2),X=W[0],Q=W[1],V=Object(c.useState)(null),Z=Object(l.a)(V,2),$=Z[0],ee=Z[1],te=Object(c.useState)(!1),ne=Object(l.a)(te,2),ce=ne[0],ie=ne[1];Object(c.useEffect)((function(){t&&(g.emit("SET_NICK",t),g.emit("JOIN_ROOM",n),g.on("START_GAME",(function(){s(1),ie(!1),H(!1)})),g.on("ROOM_UPDATE",(function(e){var t,n;e.end&&(ee(e.message),H(!0),ie(!0),N=Object(S.a)(Object(S.a)({},N),{},{alive:!0}),w={},C={},I=0),f(null===e||void 0===e?void 0:e.host),y(null===e||void 0===e?void 0:e.playersList),L(null===e||void 0===e?void 0:e.players),n=null===e||void 0===e||null===(t=e.players[g.id])||void 0===t?void 0:t.position,N.position=n,(null===e||void 0===e?void 0:e.difficulty)>0&&s(1)})),g.on("GENERATION",(function(e){var t;t=e,w=Object(S.a)(Object(S.a)({},null===t||void 0===t?void 0:t.blocks),w),C=null===t||void 0===t?void 0:t.pickups,I=null===t||void 0===t?void 0:t.limit,B(null===e||void 0===e?void 0:e.limit),K(null===e||void 0===e?void 0:e.alive)})),g.on("POSITIONS",L))}),[n,t]),Object(c.useEffect)((function(){var e;e={id:g.id},N=Object(S.a)(Object(S.a)({},N),e),D=se}),[]);var oe=function(){g.emit("START_GAME")},ae=function(e){var t=function(e){if(N.alive&&!A)return"w"!==e&&"ArrowUp"!==e||(N.position.y-=x.STEP),"s"!==e&&"ArrowDown"!==e||(N.position.y+=x.STEP),"a"!==e&&"ArrowLeft"!==e||(N.position.x-=x.STEP),"d"!==e&&"ArrowRight"!==e||(N.position.x+=x.STEP),N.position}(e);t&&g.emit("PLAYER_POSITION",t)},le=function(e){P(e),function(e){N.color=e}(e),g.emit("PLAYER_COLOR",e)},se=function(){g.emit("PLAYER_DEATH"),Q("animate-shake"),setTimeout((function(){Q(null)}),500)},re=function(){ie(!1),s(0),B(0),H(!1)};if(!t)return Object(u.jsx)(r.a,{to:"/".concat(n,"/@")});var ue="room flex-col flex-fill"+(1===a?" dark":"");return Object(u.jsx)("div",{className:ue,children:1===a?Object(u.jsxs)(u.Fragment,{children:[ce&&Object(u.jsxs)("div",{className:"end-screen flex-col",children:[Object(u.jsxs)("label",{className:"huge bold",children:[" ",$," "]}),Object(u.jsx)("button",{className:"round-btn large bold",onClick:re,children:" back to lobby "})]}),Object(u.jsxs)("div",{className:"game flex-col flex-fill",children:[Object(u.jsxs)("label",{className:"large bold center-text",children:[" ",F," player",F>1?"s":""," remaining "]}),Object(u.jsx)(Y,{className:X,onKey:ae,zoomMultiplier:z}),Object(u.jsx)(U,{onPress:ae})]})]}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsxs)("label",{className:"large bold center-text",children:[" ",p,"/",n," "]}),Object(u.jsx)(q,{id:g.id,players:m,color:k,onChange:le,children:(null===j||void 0===j?void 0:j.id)===g.id&&Object(u.jsx)("button",{className:"round-btn large bold",onClick:oe,children:" start "})})]})})},W=function(){var e=Object(c.useState)(null),t=Object(l.a)(e,2),n=t[0],i=t[1];return Object(u.jsx)("div",{className:"app",children:Object(u.jsx)(s.a,{children:Object(u.jsxs)(r.d,{children:[Object(u.jsx)(r.b,{path:"/",element:Object(u.jsx)(b,{name:n,setName:i})}),Object(u.jsx)(r.b,{path:"/:room/@",element:Object(u.jsx)(b,{name:n,setName:i})}),Object(u.jsx)(r.b,{path:"/:room",element:Object(u.jsx)(J,{name:n})})]})})})},X=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,83)).then((function(t){var n=t.getCLS,c=t.getFID,i=t.getFCP,o=t.getLCP,a=t.getTTFB;n(e),c(e),i(e),o(e),a(e)}))};a.a.render(Object(u.jsx)(i.a.StrictMode,{children:Object(u.jsx)(W,{})}),document.getElementById("root")),X()}},[[82,1,2]]]);
//# sourceMappingURL=main.0407382d.chunk.js.map